<legend ng-if="action === 'new'">{{'scheduler.scheduleJob' | translate}}</legend>
<legend ng-if="action === 'edit'">{{'scheduler.updateJob' | translate}}</legend>
<form class="form-horizontal" name="JobForm" role="form">
    <div class="form-group">
        <label for="type" class="control-label" mt-invalid="'JobForm.type.$invalid'">{{'scheduler.jobType' | translate}}</label>
        <div>
            <select id="type" class="form-control" name="type" required ng-change="typeChanged()" ng-disabled="action === 'edit'" ng-model="job['@jobType']" ng-options="type.name as type.displayName for type in jobTypes">
                <option value="" disabled selected>{{'scheduler.selectType' | translate}}</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="subject" class="control-label" mt-invalid="'JobForm.subject.$invalid'">{{'scheduler.motechEventSubject' | translate}}</label>
        <div>
            <input type="text" id="subject" class="form-control" name="subject" required placeholder="Event event subject" ng-disabled="action === 'edit'" ng-model="job.motechEvent.subject">
        </div>
    </div>
    <!-- Motech Event Parameters -->
    <input-map ng-disabled="action === 'edit'" title="{{ 'scheduler.motechEventParameters' | translate }}" ng-model="motechEventParameters"></input-map>
    <div ng-if="action !== 'edit'" class="button-group">
        <button class="button-delete" type="button" ng-click="resetMap()">{{'scheduler.resetMap' | translate}}</button>
    </div>
    <!-- Fields based on selected Job type -->
    <div class="form-group" ng-if="job['@jobType']">
        <label for="jobDateFrom" class="control-label" mt-invalid="'JobForm.startDate.$invalid'">{{'scheduler.startDate' | translate}}</label>
        <div>
            <input id="jobDateFrom" date-picker="" min="getMinDate(job['@jobType'])" max="dates.endDate" type="datetime" class="form-control" name="startDate" ng-required="job['@jobType'] !== 'CRON'" placeholder="{{msg('scheduler.enterStartDate')}}" ng-model="dates.startDate" parsed="job.startDate">
        </div>
    </div>
    <div class="form-group" ng-if="job['@jobType'] && job['@jobType'] !== 'RUN_ONCE'">
        <label for="jobDateTo" class="control-label col-sm-2">{{'scheduler.endDate' | translate}}</label>
        <div>
            <input id="jobDateTo" date-picker="" min="dates.startDate" type="datetime" class="form-control" placeholder="{{msg('scheduler.enterEndDate')}}" ng-model="dates.endDate" parsed="job.endDate">
        </div>
    </div>
    <div class="form-group" ng-if="job['@jobType'] === 'CRON'">
        <label for="cronExpression" class="control-label col-sm-2" mt-invalid="'JobForm.cronExpression.$invalid'">{{'scheduler.cronExpression' | translate}}</label>
        <div>
            <input type="text" id="cronExpression" class="form-control" name="cronExpression" required placeholder="{{msg('scheduler.enterCronExpression')}}" ng-model="job.cronExpression">
        </div>
    </div>
    <div ng-if="job['@jobType'] === 'REPEATING'">
        <div class="form-group">
            <label for="repeatCount" class="control-label col-sm-2">{{'scheduler.repeatCount' | translate}}</label>
            <div>
                <input type="number" id="repeatCount" class="form-control" min="0" placeholder="{{msg('scheduler.enterRepeatCount')}}" ng-model="job.repeatCount">
            </div>
        </div>
        <div class="form-group">
            <label for="repeatInterval" class="control-label col-sm-2" mt-invalid="'JobForm.repeatInterval.$invalid'">{{'scheduler.repeatIntervalInSeconds' | translate}}</label>
            <div>
                <input type="number" id="repeatInterval" class="form-control" name="repeatInterval" required min="0" placeholder="{{msg('scheduler.enterRepeatInterval')}}" ng-model="job.repeatIntervalInSeconds">
            </div>
        </div>
    </div>
    <div ng-if="job['@jobType'] === 'DAY_OF_WEEK'">
        <div class="form-group">
            <label for="days" class="control-label col-sm-2" mt-invalid="'JobForm.days.$invalid'">{{'scheduler.days' | translate}}</label>
            <div>
                <select name="days" required id="days" multiple="multiple" ng-model="job.days" days-of-week>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="time" class="control-label col-sm-2" mt-invalid="'JobForm.time.$invalid'">{{'scheduler.time' | translate}}</label>
            <div>
                <input id="time" class="form-control" name="time" required placeholder="{{msg('scheduler.enterTime')}}" time-picker ng-model="job.time">
            </div>
        </div>
    </div>
    <div class="form-group" ng-if="job['@jobType'] === 'REPEATING_PERIOD'">
        <label for="repeatPeriod" class="control-label col-sm-2" mt-invalid="'JobForm.repeatPeriod.$invalid'">{{'scheduler.repeatPeriod' | translate}}</label>
        <div>
            <div class="row horizontally-inside">
                <div class="input-group">
                    <input type="text" id="repeatPeriod" class="form-control col-sm-6" name="repeatPeriod" required placeholder="{{msg('scheduler.enterRepeatPeriod')}}" period-amount period-validity ng-model="job.repeatPeriod">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default period-modal-opener" data-toggle="modal" data-backdrop="static">{{'mds.form.changePeriod' | translate}}</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group" ng-if="job['@jobType'] && job['@jobType'] !== 'RUN_ONCE'">
        <label class="control-label col-sm-2" for="ignorePastFires">{{'scheduler.ignorePastFiresAtStart' | translate}}</label>
        <div>
            <input type="checkbox" id="ignorePastFires" ng-model="job.ignorePastFiresAtStart">
        </div>
    </div>
    <div ng-if="job['@jobType'] === 'REPEATING' || job['@jobType'] === 'REPEATING_PERIOD'" class="form-group">
        <label class="control-label col-sm-2" for="useOriginalFireTime">{{'scheduler.useOriginalFireTimeAfterMisfire' | translate}}</label>
        <div>
            <input type="checkbox" id="useOriginalFireTime" ng-model="job.useOriginalFireTimeAfterMisfire">
        </div>
    </div>
    <div class="form-group">
        <div class="button-group-primary">
            <button ng-if="action === 'new'" ng-disabled="!JobForm.$valid" class="button-primary" ng-click="createOrUpdateJob(action)">{{'scheduler.scheduleJob' | translate}}</button>
            <button ng-if="action === 'edit'" ng-disabled="!JobForm.$valid" class="button-primary" ng-click="createOrUpdateJob(action)">{{'scheduler.updateJob' | translate}}</button>
        </div>
    </div>
</form>
