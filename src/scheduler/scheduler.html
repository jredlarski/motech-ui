<h4 class="frame-title">{{'scheduler' | translate}}</h4>
<motech-list paginated>
    <motech-list-header>
        <div class="button-group">
            <button class="button-add" ng-click="newJob()" ui-sref="scheduler.createOrUpdateJob({ action: 'new' })" type="button">{{'scheduler.scheduleJob' | translate}}</button>
        </div>
    </motech-list-header>
    <motech-list-item ng-repeat="job in jobs.rows">
        <div column-title="Name">
            <h4>{{job.name}}</h4>
        </div>
        <motech-list-column column-title="Status"><span class="label label-primary" uib-popover="Status: {{job.status}}" popover-trigger="mouseenter" popover-placement="left">Status: <i class="fa fa-lg fa-{{getStatusIcon(job.status)}}"></i></span></motech-list-column>
        <motech-list-column column-title="Activity"><span class="label label-primary" uib-popover="Activity: {{job.activity}}" popover-trigger="mouseenter" popover-placement="left">Activity: <i class="fa fa-lg fa-{{getActivityIcon(job.activity)}}"></i></span></motech-list-column>
        <motech-list-collapsible ng-init="getDetails(job)">
            <div ng-if="job.uiDefined">
                <div class="button-group-primary">
                    <button class="button-edit" type="button" ng-click="editJob(job)" ui-sref="scheduler.createOrUpdateJob({ action: 'edit' })">Edit</button>
                    <button ng-click="deleteJob(job)" class="button-delete">Delete</button>
                </div>
                <div class="button-group">
                    <button ng-if="job.status === 'OK'" ng-click="pauseJob(job)" type="button" class="button"><i class="fa fa-1 fa-pause"></i> Pause</button>
                    <button ng-if="job.status === 'PAUSED'" ng-click="resumeJob(job)" type="button" class="button"><i class="fa fa-1 fa-play"></i> Resume</button>
                </div>
            </div>
            <div ng-if="!job.uiDefined">
                <div class="job-info">
                    <div class="key">{{'scheduler.startDate' | translate}}</div>
                    <div class="value">{{job.startDate}}</div>
                    <div class="key">{{'scheduler.endDate' | translate}}</div>
                    <div class="value">{{job.endDate}}</div>
                    <div class="key">{{'scheduler.jobType' | translate}}</div>
                    <div class="value">{{job.jobType}}</div>
                    <div class="key">{{'scheduler.info' | translate}}</div>
                    <div class="value">{{job.info}}</div>
                </div>
                <div ng-repeat="items in jobDetails[job.name].eventInfoList">
                    <div>Subject: {{items.subject}}</div>
                    <div>Key:</div>
                    <div>Value:</div>
                    <div ng-repeat="(key, value) in items.parameters">
                        <div>{{key}}</div>
                        <div>{{value}}</div>
                    </div>
                </div>
            </div>
        </motech-list-collapsible>
    </motech-list-item>
    <motech-list-footer>
        <uib-pagination total-items="totalItems" ng-model="currentPage" ng-change="changePageTo(currentPage)"></uib-pagination>
    </motech-list-footer>
</motech-list>
<motech-sidebar title="{{ 'scheduler.filters' | translate }}">
    <form>
        <fieldset>
            <legend>{{ 'scheduler.name' | translate }}</legend>
            <div class="form-group">
                <input id="jobsName" type="text" ng-model="search.name" placeholder="{{'scheduler.search' | translate }}"/>
            </div>
        </fieldset>
        <fieldset>
            <legend>{{ 'scheduler.running' | translate }}</legend>
            <div class="form-group">
                <input id="timeFrom" date-picker ng-model="search.timeFrom" max="timeTo" type="datetime" placeholder="{{'scheduler.from' | translate }}"/>
            </div>
            <div class="form-group">
                <input id="timeTo" date-picker ng-model="search.timeTo" min="timeFrom" type="datetime" placeholder="{{'scheduler.to' | translate }}"/>
            </div>
        </fieldset>
        <fieldset>
            <legend>{{'scheduler.activity' | translate }}</legend>
            <div class="input-group">
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.activity" checklist-value="'ACTIVE'" />
                    {{'scheduler.active' | translate}}
                </label>
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.activity" checklist-value="'FINISHED'" />
                    {{'scheduler.finished' | translate}}
                </label>
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.activity" checklist-value="'NOTSTARTED'" />
                    {{'scheduler.notstarted' | translate}}
                </label>
            </div>
        </fieldset>
        <fieldset>
            <legend>{{'scheduler.status' | translate }}</legend>
            <div class="input-group">
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.status" checklist-value="'OK'" />
                    {{'scheduler.ok' | translate}}
                </label>
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.status" checklist-value="'PAUSED'" />
                    {{'scheduler.paused' | translate}}
                </label>
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.status" checklist-value="'BLOCKED'" />
                    {{'scheduler.blocked' | translate}}
                </label>
                <label class="checkbox">
                    <input type="checkbox" checklist-model="search.status" checklist-value="'ERROR'" />
                    {{'scheduler.error' | translate}}
                </label>
            </div>
        </fieldset>
    </form>
</motech-sidebar>